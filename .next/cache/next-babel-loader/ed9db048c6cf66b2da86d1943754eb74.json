{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _objectWithoutProperties from \"@babel/runtime-corejs2/helpers/esm/objectWithoutProperties\";\nimport _Object$entries from \"@babel/runtime-corejs2/core-js/object/entries\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useEffect } from 'react';\nimport Link from 'next/link';\nimport { withRouter } from 'next/router';\nimport { cache, get } from '../lib/repo-cache';\nimport Repo from './Repo';\nimport api from '../lib/api';\n\nfunction makeQuery(queryObject) {\n  var query = _Object$entries(queryObject).reduce(function (result, item) {\n    result.push(item.join('='));\n    return result;\n  }, []).join('&');\n\n  return \"?\".concat(query);\n}\n\nvar isServer = false;\nexport default (function (Comp, type) {\n  var withDetail = function withDetail(_ref) {\n    var repobasic = _ref.repobasic,\n        router = _ref.router,\n        rest = _objectWithoutProperties(_ref, [\"repobasic\", \"router\"]);\n\n    console.log(repobasic);\n    var query = makeQuery(router.query);\n    useEffect(function () {\n      !isServer && cache(repobasic);\n    });\n    return __jsx(\"div\", {\n      className: \"jsx-1242838066\" + \" \" + 'root'\n    }, repobasic && repobasic.id ? __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: \"jsx-1242838066\" + \" \" + \"repo-basic\"\n    }, __jsx(Repo, {\n      repo: repobasic\n    }), __jsx(\"div\", {\n      className: \"jsx-1242838066\" + \" \" + 'tabs'\n    }, type === 'index' ? __jsx(\"span\", {\n      className: \"jsx-1242838066\" + \" \" + \"tab index\"\n    }, \"Readme\") : __jsx(Link, {\n      href: \"/detail\".concat(query)\n    }, __jsx(\"a\", {\n      className: \"jsx-1242838066\" + \" \" + \"tab index\"\n    }, \"Readme\")), type === 'issues' ? __jsx(\"span\", {\n      className: \"jsx-1242838066\" + \" \" + \"tab issues\"\n    }, \"issues\") : __jsx(Link, {\n      href: \"/detail/issues\".concat(query)\n    }, __jsx(\"a\", {\n      className: \"jsx-1242838066\" + \" \" + \"tab index\"\n    }, \"issues\")))), __jsx(Comp, rest)) : '暂无内容', __jsx(_JSXStyle, {\n      id: \"1242838066\"\n    }, \".root.jsx-1242838066{padding-top:20px;}.repo-basic.jsx-1242838066{padding:20px;border:1px solid #eee;margin-bottom:20px;border-radius:5px;}.tab.jsx-1242838066+.tab.jsx-1242838066{margin-left:20px;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFyaW1vXFxEZXNrdG9wXFxuZXh0LWdpdGh1YlxcY29tcG9uZW50c1xcd2l0aERldGFpbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpRGtCLEFBRzhCLEFBR0osQUFNSSxhQUxLLElBSHhCLEFBU0Esa0JBTHFCLG1CQUNELGtCQUNwQiIsImZpbGUiOiJDOlxcVXNlcnNcXG1hcmltb1xcRGVza3RvcFxcbmV4dC1naXRodWJcXGNvbXBvbmVudHNcXHdpdGhEZXRhaWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3VzZUVmZmVjdH0gZnJvbSAncmVhY3QnXHJcbmltcG9ydCBMaW5rIGZyb20gJ25leHQvbGluaydcclxuaW1wb3J0IHsgd2l0aFJvdXRlciB9IGZyb20gJ25leHQvcm91dGVyJ1xyXG5cclxuaW1wb3J0IHtjYWNoZSxnZXR9IGZyb20gJy4uL2xpYi9yZXBvLWNhY2hlJ1xyXG5pbXBvcnQgUmVwbyBmcm9tICcuL1JlcG8nXHJcbmltcG9ydCBhcGkgZnJvbSAnLi4vbGliL2FwaSdcclxuXHJcbmZ1bmN0aW9uIG1ha2VRdWVyeShxdWVyeU9iamVjdCl7XHJcbiAgY29uc3QgcXVlcnk9T2JqZWN0LmVudHJpZXMocXVlcnlPYmplY3QpXHJcbiAgICAucmVkdWNlKChyZXN1bHQsaXRlbSk9PntcclxuICAgICAgcmVzdWx0LnB1c2goaXRlbS5qb2luKCc9JykpXHJcbiAgICAgIHJldHVybiByZXN1bHRcclxuICB9LFtdKVxyXG4gICAgLmpvaW4oJyYnKVxyXG4gIHJldHVybiBgPyR7cXVlcnl9YFxyXG59XHJcblxyXG5jb25zdCBpc1NlcnZlciA9IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnXHJcblxyXG5leHBvcnQgZGVmYXVsdCAoQ29tcCx0eXBlKT0+e1xyXG4gIGNvbnN0IHdpdGhEZXRhaWw9KHsgcmVwb2Jhc2ljLCByb3V0ZXIsIC4uLnJlc3QgfSk9PntcclxuICAgIGNvbnNvbGUubG9nKHJlcG9iYXNpYylcclxuICAgIGNvbnN0IHF1ZXJ5ID0gbWFrZVF1ZXJ5KHJvdXRlci5xdWVyeSlcclxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICAgICFpc1NlcnZlciAmJiBjYWNoZShyZXBvYmFzaWMpXHJcbiAgICB9KVxyXG4gICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPSdyb290Jz5cclxuICAgICAge1xyXG4gICAgICAgIHJlcG9iYXNpYyYmcmVwb2Jhc2ljLmlkXHJcbiAgICAgICAgPzw+PGRpdiBjbGFzc05hbWU9XCJyZXBvLWJhc2ljXCI+XHJcbiAgICAgICAgPFJlcG8gcmVwbz17cmVwb2Jhc2ljfSAvPlxyXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPSd0YWJzJz5cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIHR5cGU9PT0naW5kZXgnXHJcbiAgICAgICAgICAgICAgPzxzcGFuIGNsYXNzTmFtZT1cInRhYiBpbmRleFwiPlJlYWRtZTwvc3Bhbj5cclxuICAgICAgICAgICAgICA6PExpbmsgaHJlZj17YC9kZXRhaWwke3F1ZXJ5fWB9PjxhIGNsYXNzTmFtZT1cInRhYiBpbmRleFwiPlJlYWRtZTwvYT48L0xpbms+XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIHR5cGU9PT0naXNzdWVzJ1xyXG4gICAgICAgICAgICAgID88c3BhbiBjbGFzc05hbWU9XCJ0YWIgaXNzdWVzXCI+aXNzdWVzPC9zcGFuPlxyXG4gICAgICAgICAgICAgIDo8TGluayBocmVmPXtgL2RldGFpbC9pc3N1ZXMke3F1ZXJ5fWB9PjxhIGNsYXNzTmFtZT1cInRhYiBpbmRleFwiPmlzc3VlczwvYT48L0xpbms+XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxDb21wIHsuLi5yZXN0fSAvPjwvPlxyXG4gICAgICA6J+aaguaXoOWGheWuuSdcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgPHN0eWxlIGpzeD57YFxyXG4gICAgICAgICAgLnJvb3Qge1xyXG4gICAgICAgICAgICBwYWRkaW5nLXRvcDogMjBweDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC5yZXBvLWJhc2ljIHtcclxuICAgICAgICAgICAgcGFkZGluZzogMjBweDtcclxuICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2VlZTtcclxuICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDtcclxuICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNXB4O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgLnRhYiArIC50YWIge1xyXG4gICAgICAgICAgICBtYXJnaW4tbGVmdDogMjBweDtcclxuICAgICAgICAgIH1cclxuICAgICAgICBgfTwvc3R5bGU+XHJcbiAgICA8L2Rpdj5cclxuICB9XHJcbiAgd2l0aERldGFpbC5nZXRJbml0aWFsUHJvcHM9IGFzeW5jIChjb250ZXh0KT0+e1xyXG4gICAgY29uc3QgeyBjdHggfSA9IGNvbnRleHRcclxuICAgIGNvbnN0IHsgb3duZXIsIG5hbWUgfSA9IGN0eC5xdWVyeVxyXG4gICAgY29uc3QgZnVsbF9uYW1lID0gYCR7b3duZXJ9LyR7bmFtZX1gXHJcbiAgICBsZXQgcGFnZURhdGE9e31cclxuICAgIFxyXG4gICAgaWYoQ29tcCYmQ29tcC5nZXRJbml0aWFsUHJvcHMpe1xyXG4gICAgICBwYWdlRGF0YSA9YXdhaXQgQ29tcC5nZXRJbml0aWFsUHJvcHMoY29udGV4dClcclxuICAgIH1cclxuICAgIGlmKGdldChmdWxsX25hbWUpKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVwb2Jhc2ljOiBnZXQoZnVsbF9uYW1lKSxcclxuICAgICAgICAuLi5wYWdlRGF0YVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBsZXQgcmVwb0Jhc2ljPXt9XHJcbiAgICB0cnkge1xyXG4gICAgIHJlcG9CYXNpYyA9IGF3YWl0IGFwaS5yZXF1ZXN0KFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHVybDogYC9yZXBvcy8ke2Z1bGxfbmFtZX1gXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjdHgucmVxLFxyXG4gICAgICAgIGN0eC5yZXNcclxuICAgICAgKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5sb2coJ2Vycm9yJylcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJlcG9iYXNpYzogaXNTZXJ2ZXI/cmVwb0Jhc2ljLmRhdGE6cmVwb0Jhc2ljLmRhdGEuZGF0YSxcclxuICAgICAgLi4ucGFnZURhdGFcclxuICAgIH1cclxuXHJcbiAgfVxyXG4gIHJldHVybiB3aXRoUm91dGVyKHdpdGhEZXRhaWwpXHJcbn0iXX0= */\\n/*@ sourceURL=C:\\\\Users\\\\marimo\\\\Desktop\\\\next-github\\\\components\\\\withDetail.js */\"));\n  };\n\n  withDetail.getInitialProps =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(context) {\n      var ctx, _ctx$query, owner, name, full_name, pageData, repoBasic;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              ctx = context.ctx;\n              _ctx$query = ctx.query, owner = _ctx$query.owner, name = _ctx$query.name;\n              full_name = \"\".concat(owner, \"/\").concat(name);\n              pageData = {};\n\n              if (!(Comp && Comp.getInitialProps)) {\n                _context.next = 8;\n                break;\n              }\n\n              _context.next = 7;\n              return Comp.getInitialProps(context);\n\n            case 7:\n              pageData = _context.sent;\n\n            case 8:\n              if (!get(full_name)) {\n                _context.next = 10;\n                break;\n              }\n\n              return _context.abrupt(\"return\", _objectSpread({\n                repobasic: get(full_name)\n              }, pageData));\n\n            case 10:\n              repoBasic = {};\n              _context.prev = 11;\n              _context.next = 14;\n              return api.request({\n                url: \"/repos/\".concat(full_name)\n              }, ctx.req, ctx.res);\n\n            case 14:\n              repoBasic = _context.sent;\n              _context.next = 20;\n              break;\n\n            case 17:\n              _context.prev = 17;\n              _context.t0 = _context[\"catch\"](11);\n              console.log('error');\n\n            case 20:\n              return _context.abrupt(\"return\", _objectSpread({\n                repobasic: isServer ? repoBasic.data : repoBasic.data.data\n              }, pageData));\n\n            case 21:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[11, 17]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return withRouter(withDetail);\n});","map":{"version":3,"sources":["C:\\Users\\marimo\\Desktop\\next-github\\components\\withDetail.js"],"names":["useEffect","Link","withRouter","cache","get","Repo","api","makeQuery","queryObject","query","reduce","result","item","push","join","isServer","Comp","type","withDetail","repobasic","router","rest","console","log","id","getInitialProps","context","ctx","owner","name","full_name","pageData","repoBasic","request","url","req","res","data"],"mappings":"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","sourcesContent":["import {useEffect} from 'react'\r\nimport Link from 'next/link'\r\nimport { withRouter } from 'next/router'\r\n\r\nimport {cache,get} from '../lib/repo-cache'\r\nimport Repo from './Repo'\r\nimport api from '../lib/api'\r\n\r\nfunction makeQuery(queryObject){\r\n  const query=Object.entries(queryObject)\r\n    .reduce((result,item)=>{\r\n      result.push(item.join('='))\r\n      return result\r\n  },[])\r\n    .join('&')\r\n  return `?${query}`\r\n}\r\n\r\nconst isServer = typeof window === 'undefined'\r\n\r\nexport default (Comp,type)=>{\r\n  const withDetail=({ repobasic, router, ...rest })=>{\r\n    console.log(repobasic)\r\n    const query = makeQuery(router.query)\r\n    useEffect(() => {\r\n      !isServer && cache(repobasic)\r\n    })\r\n    return <div className='root'>\r\n      {\r\n        repobasic&&repobasic.id\r\n        ?<><div className=\"repo-basic\">\r\n        <Repo repo={repobasic} />\r\n        <div className='tabs'>\r\n            {\r\n              type==='index'\r\n              ?<span className=\"tab index\">Readme</span>\r\n              :<Link href={`/detail${query}`}><a className=\"tab index\">Readme</a></Link>\r\n            }\r\n            {\r\n              type==='issues'\r\n              ?<span className=\"tab issues\">issues</span>\r\n              :<Link href={`/detail/issues${query}`}><a className=\"tab index\">issues</a></Link>\r\n            }\r\n        </div>\r\n      </div>\r\n      <Comp {...rest} /></>\r\n      :'暂无内容'\r\n      }\r\n      \r\n      <style jsx>{`\r\n          .root {\r\n            padding-top: 20px;\r\n          }\r\n          .repo-basic {\r\n            padding: 20px;\r\n            border: 1px solid #eee;\r\n            margin-bottom: 20px;\r\n            border-radius: 5px;\r\n          }\r\n          .tab + .tab {\r\n            margin-left: 20px;\r\n          }\r\n        `}</style>\r\n    </div>\r\n  }\r\n  withDetail.getInitialProps= async (context)=>{\r\n    const { ctx } = context\r\n    const { owner, name } = ctx.query\r\n    const full_name = `${owner}/${name}`\r\n    let pageData={}\r\n    \r\n    if(Comp&&Comp.getInitialProps){\r\n      pageData =await Comp.getInitialProps(context)\r\n    }\r\n    if(get(full_name)) {\r\n      return {\r\n        repobasic: get(full_name),\r\n        ...pageData\r\n      }\r\n    }\r\n    let repoBasic={}\r\n    try {\r\n     repoBasic = await api.request(\r\n        {\r\n          url: `/repos/${full_name}`\r\n        },\r\n        ctx.req,\r\n        ctx.res\r\n      )\r\n    } catch (error) {\r\n      console.log('error')\r\n    }\r\n    return {\r\n      repobasic: isServer?repoBasic.data:repoBasic.data.data,\r\n      ...pageData\r\n    }\r\n\r\n  }\r\n  return withRouter(withDetail)\r\n}"]},"metadata":{},"sourceType":"module"}