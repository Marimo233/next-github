{"version":3,"file":"static/webpack/static\\development\\pages\\detail\\issues.js.73bc2333b831ba0eb454.hot-update.js","sources":["webpack:///./pages/detail/issues.js"],"sourcesContent":["import dynamic from 'next/dynamic'\r\nimport { useState, useCallback, useEffect } from 'react'\r\nimport { Avatar, Button, Select, Spin } from 'antd'\r\n\r\nimport withDetail from '../../components/withDetail'\r\nimport api from '../../lib/api'\r\nimport {getLastUpdated} from '../../lib/utils'\r\nimport SearchUser from '../../components/SearchUser'\r\n\r\nconst Option=Select.Option\r\nconst Markdown=dynamic(()=>import ('../../components/Markdown'))\r\nconst isServer=typeof window==='undefined'\r\n\r\nfunction IssueDetail({issue}){\r\n  return (\r\n    <div className='root'>\r\n      <Markdown content={issue.body} />\r\n       <div className='actions'>\r\n          <Button href={issue.html_url} target=\"_blank\">\r\n              打开issue讨论页面\r\n          </Button>\r\n       </div>\r\n       <style jsx>{`\r\n       .root {\r\n          background: #fafafa;\r\n          padding: 20px;\r\n        }\r\n        .actions {\r\n          text-align: right;\r\n        }\r\n         `}</style>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction IssueItem({issue}){\r\n  const [showDetail, setShowDetail] = useState(false)\r\n  // 这个写法就可以不依赖showDetail。这么写可以避开闭包\r\n  const toggleShowDetail = useCallback(() => {\r\n    setShowDetail(detail => !detail)\r\n  }, [])\r\n  return (\r\n    <div>\r\n      <div className='issue'>\r\n        <Button\r\n          type=\"primary\"\r\n          size=\"small\"\r\n          style={{\r\n            position: 'absolute',\r\n            top: 10,\r\n            right: 10\r\n          }}\r\n          onClick={toggleShowDetail}\r\n        >\r\n          {showDetail?'隐藏':'查看'}\r\n        </Button>\r\n      </div>\r\n      <div className=\"avatar\">\r\n          <Avatar src={issue.user.avatar_url} shape=\"square\" size={50}></Avatar>\r\n      </div>\r\n      <div className=\"main-info\">\r\n          <h6>\r\n            <span>{issue.title}</span>\r\n          </h6>\r\n          <p className=\"sub-info\">\r\n            <span>Updated at {getLastUpdated(issue.updated_at)}</span>\r\n          </p>\r\n          <style jsx>{`\r\n          .issue {\r\n            display: flex;\r\n            position: relative;\r\n            padding: 10px;\r\n          }\r\n          .issue:hover {\r\n            background: #fafafa;\r\n          }\r\n          .issue + .issue {\r\n            border-top: 1px solid #eee;\r\n          }\r\n          .main-info > h6 {\r\n            max-width: 600px;\r\n            font-size: 16px;\r\n            padding-right: 40px;\r\n          }\r\n          .avatar {\r\n            margin-right: 20px;\r\n          }\r\n          .sub-info {\r\n            margin-bottom: 0;\r\n          }\r\n          .sub-info > span + span {\r\n            display: inline-block;\r\n            margin-left: 20px;\r\n            font-size: 12px;\r\n          }\r\n        `}</style>\r\n      </div>\r\n      {showDetail ? <IssueDetail issue={issue} /> : null}\r\n    </div>\r\n  )\r\n}\r\n\r\nconst Issues=({issues,labels})=>{\r\n\r\nconst [creator,setCreator]=useState('')\r\nconst [state,setState]=useState('all')\r\nconst [label,setLabel]=useState([])\r\n\r\n  // 选中用户结果的回调\r\n  const handleCreatorChange = useCallback(value => {\r\n    setCreator(value)\r\n  }, [])\r\n\r\n  // 选中状态结果的回调\r\n  const handleStateChange = useCallback(value => {\r\n    setState(value)\r\n  }, [])\r\n\r\n  // 选中label结果的回调\r\n  const handleLabelChange = useCallback(value => {\r\n    setLabel(value)\r\n  }, [])\r\n  \r\n    return (\r\n      <div className='root'>\r\n        <div className='search'>\r\n          <SearchUser onChang={handleCreatorChange} value={creator}/>\r\n          <Select\r\n            placeholder=\"状态\"\r\n            onChange={handleStateChange}\r\n            value={state}\r\n            style={{ width: 200, marginLeft: 20 }}\r\n          >\r\n            <Option value='all'>all</Option>\r\n            <Option value='open'>open</Option>\r\n            <Option value='closed'>closed</Option>\r\n          </Select>\r\n          {/* <Select\r\n          mode=\"multiple\"\r\n          placeholder=\"Label\"\r\n          onChange={handleLabelChange}\r\n          value={label}\r\n          style={{ flexGrow: 1, marginLeft: 20, marginRight: 20 }}\r\n          >\r\n            {labels\r\n            ?labels.map(la => (\r\n              <Option value={la.name} key={la.id}>\r\n                {la.name}\r\n              </Option>\r\n            ))\r\n            :''\r\n        }\r\n        </Select> */}\r\n        <Button type=\"primary\" onClick={handleSearch} disabled={fetching}>\r\n          搜索\r\n        </Button>\r\n        </div>\r\n        <div className='issues'>\r\n          {issues.map((item)=>{\r\n            return <IssueItem issue={item} />\r\n          })}\r\n        </div>\r\n        <style jsx>{`\r\n        .issues {\r\n          border: 1px solid #eee;\r\n          border-radius: 5px;\r\n          margin-bottom: 20px;\r\n          margin-top: 20px;\r\n        }\r\n        .search {\r\n          display: flex;\r\n        }\r\n        .loading {\r\n          height: 400px;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n        }\r\n      `}</style>\r\n      </div>\r\n    )\r\n}\r\n\r\nIssues.getInitialProps=async ({ctx})=>{\r\n  const {owner,name}=ctx.query\r\n  let issues=[]\r\n  try {\r\n    const issuesResp=await api.request({\r\n      url: `/repos/${owner}/${name}/issues`\r\n    },ctx.req,ctx.res)\r\n    return {\r\n      issues:isServer?issuesResp.data:issuesResp.data.dat\r\n    }\r\n  } catch (error) {\r\n    console.log(error)\r\n    return {\r\n      issues\r\n    }\r\n  }\r\n}\r\nexport default  withDetail(Issues,'issues')\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAHA;AAAA;AAkBA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AARA;AAaA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AALA;AAAA;AAqCA;AAAA;AAGA;AACA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AACA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAJA;AAMA;AAAA;AACA;AAAA;AACA;AAAA;AAkBA;AAAA;AAAA;AAAA;AAIA;AAAA;AAEA;AAAA;AAAA;AACA;AApCA;AAAA;AAyDA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAFA;AAAA;AAAA;AAKA;AADA;AACA;AALA;AAIA;AAJA;AAQA;AADA;AACA;AARA;AAAA;AAAA;AAWA;AAXA;AAaA;AADA;AACA;AAbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAgBA;;;;A","sourceRoot":""}